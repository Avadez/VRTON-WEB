<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Loading Test - VRTon</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .hero-video { height: 300px; position: relative; overflow: hidden; }
        #background-video { width: 100%; height: 100%; object-fit: cover; }
        .log { background: #f5f5f5; padding: 10px; margin-top: 10px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Video Loading Optimization Test</h1>
    
    <div class="test-section">
        <h2>Video Element (should load optimally based on device/connection)</h2>
        <div class="hero-video">
            <video 
                autoplay 
                loop 
                muted 
                playsinline 
                preload="none" 
                poster="assets/icons/icon-512x512.webp"
                id="background-video"
                data-src-webm="assets/fondo.webm"
                data-src-mp4="assets/fondo-optimized.mp4"
                data-src-mobile="assets/fondo-mobile.mp4">
                <source type="video/webm">
                <source type="video/mp4">
                Your browser does not support the video element.
            </video>
        </div>
        <div class="log" id="video-log">Loading video optimizer...</div>
    </div>

    <script>
        // Logging function
        function log(message) {
            const logElement = document.getElementById('video-log');
            logElement.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }

        // Monitor video loading
        const video = document.getElementById('background-video');
        
        video.addEventListener('loadstart', () => log('Video loading started'));
        video.addEventListener('loadeddata', () => log('Video data loaded'));
        video.addEventListener('canplay', () => log('Video can start playing'));
        video.addEventListener('play', () => log('Video started playing'));
        video.addEventListener('error', (e) => log('Video error: ' + e.message));

        // Monitor network requests (if supported)
        if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
                list.getEntries().forEach((entry) => {
                    if (entry.name.includes('fondo') || entry.name.includes('.mp4') || entry.name.includes('.webm')) {
                        log(`Network request: ${entry.name.split('/').pop()} (${Math.round(entry.duration)}ms, ${Math.round(entry.transferSize/1024)}KB)`);
                    }
                });
            });
            observer.observe({ entryTypes: ['resource'] });
        }

        log('Test page loaded');
    </script>
    
    <!-- Load the video optimizer -->
    <script src="scripts/video-optimizer.js"></script>
    
    <script>
        // Initialize video optimizer manually for testing
        setTimeout(() => {
            if (window.VideoOptimizer) {
                log('VideoOptimizer class available');
                log('Connection info: ' + (navigator.connection ? navigator.connection.effectiveType : 'unknown'));
                log('Screen width: ' + window.innerWidth + 'px');
                log('Prefers reduced motion: ' + window.matchMedia('(prefers-reduced-motion: reduce)').matches);
            } else {
                log('ERROR: VideoOptimizer class not available');
            }
        }, 1000);
    </script>
</body>
</html>
